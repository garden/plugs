<!doctype html>
<meta charset=utf-8>
<meta name=viewport content='width=device-width'>
<title> {{= title in html}} </title>

<link rel=stylesheet href=/lib/css/preview.css>
<link rel=stylesheet href=/lib/css/typejax.css>

<style>
  #preview {
    font-family: Georgia, "Times New Roman", Times, serif;
  }
</style>

<iframe id=source src="{{= file.path in path in xmlattr}}?plug=pencil"></iframe>
<div id=preview></div>

<script src=/lib/js/typejax.js></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    skipStartupTypeset: true,
    TeX: {
      extensions: ["color.js", "extpfeil.js"]
    },
    "HTML-CSS": {
      imageFont: null
    }
  });
</script>
<script src=https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML></script>

<script>
  var source =  document.getElementById('source'),
      preview = document.getElementById('preview'),
      prev = '', next = '', delay = null;

  function update() {
    typejax.updater.puttask(0, prev.length, prev, next, next.length, preview);
    prev = next;
  }

  source.contentWindow.addEventListener('message', function(event) {
    next = event.data;
    clearTimeout(delay);
    delay = setTimeout(update, 50);
  });
</script>

<!-- Google Analytics -->
<script>var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-27876347-1']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})()</script>

